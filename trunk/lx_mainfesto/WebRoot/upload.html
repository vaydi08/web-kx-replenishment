<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>中街大悦城 活动</title>
		<meta http-equiv="keywords" content="enter,your,keywords,here" />
		<meta http-equiv="description" content="A short description of this page." />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		
		<link href="script/swfupload/default.css" rel="stylesheet" type="text/css" />
    
	    <script type="text/javascript" src="script/swfupload/swfupload.js"></script>
		<script type="text/javascript" src="script/swfupload/swfupload.queue.js"></script>
		<script type="text/javascript" src="script/swfupload/fileprogress.js"></script>
		<script type="text/javascript" src="script/swfupload/handlers.js"></script>
		
		<script type="text/javascript" src="script/jquery/jquery.js"></script>
		
		<style>
		body{text-align:center;}
		table{text-align:left;}
		
		#text1Div{margin-top:90px;margin-left:20px;color:#000;font-family:'黑体';font-size:26px;font-weight:bold;}
		#text1Div #text1{background:transparent;border:0px;border-bottom:1px solid #000;margin-bottom:0px;margin-left:5px;}
		#text2Div{margin-left:20px;color:#000;font-family:'黑体';font-size:26px;font-weight:bold;}
		#text2Div #text2{background:transparent;border:0px;border-bottom:1px solid #000;margin-bottom:0px;margin-left:5px;}
		
		#s_btn_div input {width:60px;height:30px;background:url('images/s_reload.gif');border:0px;}
		</style>
		
		<script>
		var param = {text1:'',text2:'',x:'10',y:'50',color:'1',file:''};
		
		var loadMsg = '<img src="images/loading.gif"/>正在处理中...请稍候';
		var swfu;
		window.onload = function (){

			swfu = new SWFUpload({
				upload_url:"img!upload.action",
				flash_url:"script/swfupload/swfupload.swf",
				file_size_limit:"2048",
				file_upload_limit:0,
				//post_params:{text1:$("#text1").val(),text2:$("#text2").val(),x:param.x,y:param.y,color:param.color},
				custom_settings : {
					//progressTarget : "fsUploadProgress",
					cancelButtonId : "btnCancel"
				},

				button_image_url: "images/upload_btnmark1.gif",
				button_width: "400",
				button_height: "300",
				button_placeholder_id: "spanButtonPlaceHolder",
				//button_text: '<span class="theFont">上传图片</span>',
				button_text_style: ".theFont { font-size: 12px; }",
				button_text_left_padding: 5,
				button_text_top_padding: 1,
				button_cursor:-2,

				button_action:-100,
				

				file_queued_handler : fileQueued,
				file_queue_error_handler : function(){alert('哦,对不起,上传照片最大只能2M');},
				file_dialog_complete_handler : fileDialogComplete,
				upload_start_handler : function() {
					var post = {text1:$("#text1").val(),text2:$("#text2").val(),x:param.x,y:param.y,color:param.color};
					swfu.setPostParams(post);
					$("#loadMsg").html(loadMsg);
				},
				upload_progress_handler : uploadProgress,
				upload_error_handler : uploadError,
				upload_success_handler : function(file,data) {
					$("#loadMsg").html('');
	
					var ret = eval('(' + data + ')');

					$("#swfuploaddiv").hide();
					$("#temp").show();

					param.file = ret.file;
					param.text1 = ret.text1;
					param.text2 = ret.text2;
					param.x = ret.x;
					param.y = ret.y;
					param.color = ret.color;
					//alert(data);
					if(ret.success) {
						src = "image.jsp?img=" + param.file + ".jpg&tmp=" + Math.random();
						$("#temp").attr("src",src);
					} else {
						src = "image.jsp?img=" + param.file;
						$("#temp").attr("src",src);
					}
					
				},
				upload_complete_handler : uploadComplete,
				queue_complete_handler : queueComplete
			});
		}
		var setParam = function(ret) {
			param.file = ret.file;
			param.text1 = ret.text1;
			param.text2 = ret.text2;
			param.x = ret.x;
			param.y = ret.y;
			param.color = ret.color;
		}

		var src;
		var textTemp = function() {
			if($("#text1").val().length + $("#text2").val().length > 10) {
				alert('心声只能写10个哦');
				return;
			}
				
			$("#loadMsg").html(loadMsg);
			param.text1 = $("#text1").val();
			param.text2 = $("#text2").val();
			$.post('img!textTemp.action',param,function(data){
				var ret = eval('(' + data + ')');

				setParam(ret);		
				if(ret.success) {
					//$("#temp").attr("src","image.jsp?img=images/unupload.gif");
					document.getElementById("temp").src='images/unupload.gif';
					//src = "image.jsp?tmp1=" + Math.random() + "&img=" + param.file + ".jpg&tmp=" + Math.random();
					src = "temp/" + param.file + ".jpg?tmp=" + Math.random();
					setTimeout('document.getElementById("temp").src="temp/" + param.file + ".jpg?tmp=" + Math.random();',1000);
				}

				$("#loadMsg").html('');
			});
		}

		var reloadPic = function() {
			document.getElementById("temp").src='images/unupload.gif';
			setTimeout('document.getElementById("temp").src="temp/" + param.file + ".jpg?tmp=" + Math.random();',500);
		}

		var colorTemp = function(color) {
			param.color = color;
			textTemp();
		}
		var locationTemp = function(x,y) {
			param.x = x;
			param.y = y;
			textTemp();
		}

		function weibo(url,title,pic) {
			url = encodeURIComponent(url);
			title = encodeURIComponent(title);
			pic = encodeURIComponent(pic);
			var a = "http://service.weibo.com/share/share.php?url=" + url + "&appkey=&title=" + title + "&pic=" + pic + "&ralateUid=1844262925";
			location.href=a;
		}
		
		var submit = function() {
			if(param.text1 != "" && param.text2 != "" && param.file != "") {
				$.post('img!submit.action',param,function(data){
					var ret = eval('(' + data + ')');
					var title = "#光棍秀# 光棍最" + ret.text1 + " 因为" + ret.text2 + " 快来秀自己身边的光棍吧!";
					if(ret.success) {
						weibo('http://www.shenyangjoycity.com/mainfesto/index.html',title,'http://www.shenyangjoycity.com:8080/mainfesto/pic/' + ret.file);
					} else {
						alert("抱歉,有错误产生,不能正常提交,请重试");
					}
				});
			}
		}

		</script>
	</head>
	<body>
		<table cellpadding="0" cellspacing="0" border="0" width="" align="center">
		<tr>
		<td width="242">
		&nbsp;
		</td>
		<td width="38">&nbsp;</td>
		<td width="408">
		&nbsp;
		</td>
		<td width="38">&nbsp;</td>
		<td width="280" height="30">
		<iframe width="63" height="24" frameborder="0" allowtransparency="true" marginwidth="0" marginheight="0" scrolling="no" frameborder="No" border="0" src="http://widget.weibo.com/relationship/followbutton.php?width=63&height=24&uid=1844262925&style=1&btn=red&dpc=1"></iframe>
		</td>
		</tr>
				
		<tr>
		<td style="background:url('images/upload1.gif') no-repeat;" height="385">
		<!-- <textarea id="text" rows="4" cols="22" style="margin-top:85px;margin-left:12px;background:transparent;border:0px;overflow:hidden;"></textarea> -->
		<div id="text1Div">光棍最<input type="text" id="text1" name="text1" maxlength="10" size="5"/></div>
		<div id="text2Div">因为<input type="text" id="text2" name="text2" maxlength="10" size="5"/></div>
		<br/>
		<div align="right" style="margin-top:45px"><a href="javascript:void(0)" onclick="textTemp()"><img src="images/btn_text.gif"/></a></div>
		<div align="right" id="loadMsg"></div>
		</td>
		<td>&nbsp;</td>
		<td style="background:url('images/upload2.gif') no-repeat;">
		<div style="height:50px">&nbsp;</div>
		<!-- <img id="temp" width="400" height="300" src="images/unupload.gif" style="padding-left:5px;display:none"/> -->
		<iframe frameborder="0" marginheight="0" marginwidth="0" width="400" height="300" scrolling="no" id="temp" style="display:none"></iframe>
		<div align="center" id="swfuploaddiv">
			<div id="spanButtonPlaceHolder" style="width:400px;height:300px"></div>
			<div style="position:absolute;left:-1000px"><input id="btnCancel" type="button" value="取消上传" onclick="swfu.cancelQueue();" disabled="disabled" /></div>
		</div>
		<div style="margin-top:5px" id="s_btn_div">
			<input type="button" id="s_white" onclick="colorTemp('1')" style="background:url('images/s_white.gif');"/>
			<input type="button" id="s_black" onclick="colorTemp('0')" style="background:url('images/s_black.gif');"/>
			<input type="button" id="s_leftup" onclick="locationTemp('10','50')" style="background:url('images/s_leftup.gif');"/>
			<input type="button" id="s_leftdown" onclick="locationTemp('10','180')" style="background:url('images/s_leftdown.gif');"/>
			<input type="button" id="s_rightup" onclick="locationTemp(300-$('#text2').val().length*40,'50')" style="background:url('images/s_rightup.gif');"/>
			<input type="button" id="s_rightdown" onclick="locationTemp(300-$('#text2').val().length*40,'180')" style="background:url('images/s_rightdown.gif');"/>
			<input type="button" id="s_reloadPic" onclick="reloadPic()" style="background:url('images/s_reload.gif');"/>
		</div>
		</td>
		<td>&nbsp;</td>
		<td style="background:url('images/upload3.gif') no-repeat;">
		<div style="margin-top:48px;width:18px">&nbsp;</div>
		<div><a href="javascript:void(0)" onclick="submit()"><img src="images/up_submit.gif"/></a></div>
		<div style="margin-top:180px"><a href="http://weibo.com/syjoycity" target="_blank"><img src="images/up_huodong.gif"/></a></div>
		<div style="margin-top:10px"><a href="http://weibo.com/syjoycity" target="_blank"><img src="images/up_link1.gif"/></a><a href="http://weibo.com/syjoycity" target="_blank"><img src="images/up_link2.gif"/></a></div>
		</td>
		</tr>
		
		<tr><td>&nbsp;</td></tr>
		<tr>
		<td colspan="5" align="center" style="width:966px;height:550px;background:url('images/upload4.gif') no-repeat center;cursor:pointer;" onclick="location.href='img!list.action'">
		<iframe src="img!list2.action" frameborder="0" marginheight="0" marginwidth="0" width="860" height="190" scrolling="no" id="list" style="margin-top:340px;margin-left:95px"></iframe>
		</td>
		</tr>
		</table>
	
	
	
		<div class="fieldset flash" id="fsUploadProgress" style="position:absolute;left:-1000px">
			<span class="legend">Upload Queue</span>
		</div>
		<div id="divStatus" style="position:absolute;left:-1000px">0 Files Uploaded</div>

	</body>
</html>
