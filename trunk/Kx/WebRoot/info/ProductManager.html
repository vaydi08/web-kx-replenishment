
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title></title>
    
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!-- NORMAL STYLE -->
	<link rel="stylesheet" type="text/css" href="../images/style_easyui.css" />
	
	<!-- EASYUI -->
	<link rel="stylesheet" type="text/css" href="../script/easyui/themes/default/easyui.css" />
	<link rel="stylesheet" type="text/css" href="../script/easyui/themes/icon.css" />

	<script type="text/javascript" src="../script/easyui/jquery-1.6.min.js"></script>
	<script type="text/javascript" src="../script/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../script/easyui/locale/easyui-lang-zh_CN.js"></script>
	
	<!-- EXTENSION -->
	<script type=text/javascript src="../script/easyui/datagrid-detailview.js"></script>

	<!-- DEFAULT -->
	<script type="text/javascript" src="../script/sol-easyui-action.js"></script>
		<script>
		var onImport = function() {
			$("#upload").dialog('open');
		}
		$(function(){
			// 上传对话框
			$("#upload").dialog({
				onClose:function() {
					$("#listTable").datagrid('reload');
				}
			});
		
			// 查询面板
			$("#queryPanel").queryPanel({
				getparam:function(value){
					var queryType = $("#queryType").val();
					var type1 = $("#type1").combobox('getValue');
					var type2 = $("#type2").combobox('getValue');
					var type3 = $("#type3").combobox('getValue');
					var type4 = $("#type4").combobox('getValue');

					return {"queryType":queryType,"queryValue":value,"type1":type1,"type2":type2,"type3":type3,"type4":type4};
				}
			});

			$("#dlg").crud({
				onSubmit:function() {
					var type1 = $("#add_type1").combobox('getValue');
					var type2 = $("#add_type2").combobox('getValue');
					var type3 = $("#add_type3").combobox('getValue');
					var type4 = $("#add_type4").combobox('getValue');

					if(!(type1 > 0 && type2 > 0 && type3 > 0 && type4 > 0 && $("form").form('validate'))){
						$.messager.show({title:'Field',msg:"数据请填写不完整"});
						return false;
					} else
						return true;
				}
			});

			var onAdd = function() {
				form_url = "info-product!add.action";
				$("#dlg").dialog('open');
				$("#form").form('clear');
				$("#add_type1").combobox('setValue',0);
				$("#add_type2").combobox('setValue',0);
				$("#add_type3").combobox('setValue',0);
				$("#add_type4").combobox('setValue',0);
				$("#unit").validatebox('setValue','件');
			}
			var onEdit = function() {
				var row = $("#listTable").datagrid('getSelected');
				if (row){
					form_url = "info-product!edit.action";
					$("#dlg").dialog('open');
					$("#form").form('load',row);
				}
				$("#add_type1").combobox('setValue',row.type1_id);
				$("#add_type2").combobox('setValue',row.type2_id);
				$("#add_type3").combobox('setValue',row.type3_id);
				$("#add_type4").combobox('setValue',row.type4_id);
			}
			var onRemove = function() {
				var row = $("#listTable").datagrid('getSelected');
				if(row) {
					$.messager.confirm('确认删除','将要删除此产品,删除操作不可恢复,请确认?',function(b){
						if(b) {
							$.post("info-product!delete.action",{"input.id":row.id},function(data){
								var result = eval('(' + data + ')');
								if(result.success)
									$("#listTable").datagrid('reload');
								else
									$.messager.show({title:"Error",msg:result.msg});
							});
						}
					})
				}
			}
			// 数据表格
			$("#listTable").grid({
				title:"产品列表",
				url:"info-product!manager.action",
				multi:false,
				columns:[[
			        {field:'type',title:'类别',width:120,
				        formatter:function(value,rec) {
							return rec.type1_cname + "-" + rec.type2_cname + "-" + rec.type3_cname + "-" + rec.type4_cname;
			        }},
			        {field:'pname',title:'产品名称',width:80},
			        {field:'pcode',title:'产品代码',width:80},
			        {field:'unit',title:'单位',width:40}
			    ]],
			    //tools:[{"type":"add","text":"添加产品"},{"type":"edit","text":"修改产品"},{"type":"-"},{"type":"remove","text":"删除产品"},{"type":"-"},{"type":"other","text":"添加分类"}],
			    toolbar:[{id:"btnadd",text:"添加产品",iconCls:"icon-add",handler:onAdd},
			    		{id:"btnedit",text:"修改产品",iconCls:"icon-edit",handler:onEdit},
			    		{id:"btnremove",text:"删除产品",iconCls:"icon-remove",handler:onRemove},
			    		'-',
			    		{id:"btnimport",text:"从Excel导入",iconCls:"icon-import",handler:onImport},
			    		{id:"btnexport",text:"导出文件",iconCls:"icon-export",handler:function(){window.open('info-product!export.action')}}
			    		],
			    dlg:"#dlg",
			    form:"#form",
			    addUrl:"info-product!add.action",
			    editUrl:"info-product!edit.action",
				view: detailview,
				detailFormatter:function(index,row){   
			        return '<DIV style="padding-bottom: 5px; padding-left: 0px; padding-right: 0px; padding-top: 5px" id="ddv-' + index + '"></DIV>';   
			    },   
			    onExpandRow: function(index,row) {
			        $('#ddv-'+index).panel({   
			            border:false,   
			            cache:false,   
			            href:'info-product!details.action?pid=' + row.id,
			            onLoad:function(){
			                $('#listTable').datagrid('fixDetailRowHeight',index);   
			            }   
			        });   
			        $('#listTable').datagrid('fixDetailRowHeight',index);   
			    }
			});

			//查询面板下拉菜单
			$("#type1").mycombo({
				url:"info-category!combobox.action?clevel=1"
			});
			$("#type2").mycombo({
				url:"info-category!combobox.action?clevel=2"
			});
			$("#type3").mycombo({
				url:"info-category!combobox.action?clevel=3"
			});
			$("#type4").mycombo({
				url:"info-category!combobox.action?clevel=4"
			});

			//添加面板下拉菜单
			$("#add_type1").mycombo({
				url:"info-category!combobox.action?clevel=1"
			});
			$("#add_type2").mycombo({
				url:"info-category!combobox.action?clevel=2"
			});
			$("#add_type3").mycombo({
				url:"info-category!combobox.action?clevel=3"
			});
			$("#add_type4").mycombo({
				url:"info-category!combobox.action?clevel=4"
			});

		});

		
	</script>
  </head>
  
  <body>
	
	<div id="right" >
		<div id="queryPanel">
			<table cellpadding="0" cellspacing="0" border="0">
				<tr>
				<td width="120" align="center">
				<select id="type1" >
				</select>
				</td>
				
				<td width="120" align="center">
				<select id="type2" >
				</select>
				</td>
				
				<td width="120" align="center">
				<select id="type3" >
				</select>
				</td>
				
				<td width="120" align="center">
				<select id="type4" >
				</select>
				</td>
				
				<td>
				<input type="hidden" id="queryType"/>
				<input id="EU_queryType"></input>  
				           
				<div id="EU_queryValue" style="width:100px">  
				    <div name="pname">品　名</div>  
				    <div name="pcode">代　码</div>
				    <div name="unit">单　位</div>
				</div>
				</td>
				
				</tr>
			</table>

		</div>
		
		<div class="list">

			<table id="listTable"></table>

		</div>
	</div>
	
	<div id="dlg" buttons="#dlg-buttons" style="padding:10px 20px">
	<form id="form" method="post" >
	<table cellpadding="0" cellspacing="0" border="0">
		<tr>
		<td width="140" height="30">
		<select id="add_type1" name="input.type1.id"></select>
		</td>
		
		<td width="140" >
		<select id="add_type2" name="input.type2.id"></select>
		</td>
		
		<td width="140" >
		<select id="add_type3" name="input.type3.id"></select>
		</td>
		
		<td width="140" >
		<select id="add_type4" name="input.type4.id"></select>
		</td>
		</tr>
		
	</table>

		
		<div class="clear5"></div>
		
		<input type="hidden" name="input.id" id="id" />
		<table border="0" cellpadding="0" cellspacing="0">
		<tr>
		<td width="70" height="30">商品品名</td>
		<td width="230"><input type="text" name="input.pname" value="" id="pname" required="true" validType="length[1,20]" class="easyui-validatebox"/></td>
		<td width="70" >商品代码</td>
		<td width="230"><input type="text" name="input.pcode" value="" id="pcode"  required="true" validType="length[1,20]" class="easyui-validatebox"/></td>
		</tr>
		<tr>
		<td width="70" height="30">单　　位</td>
		<td colspan="3"><input type="text" name="input.unit" id="unit"  required="true" validType="length[1,20]" class="easyui-validatebox" /></td>
		</tr>
		<tr>
		<td width="70" height="30">图　　片</td>
		<td colspan="3"><input type="file" name="input.image" id="image"/></td>
		</tr>
		
		</table>
	</form>
	</div>
	
	<div id="dlg-buttons">
		<a href="#" class="easyui-linkbutton" iconCls="icon-ok" id="dlg-save">保存</a>
		<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" id="dlg-cancel">取消</a>
	</div>
	
	<div title="导入文件" style="width:600px;height:300px" modal="true" id="upload" closed="true">
	<iframe frameborder="0" src="upload2.html" width="600" height="300"/>
	</div>
  </body>
</html>
